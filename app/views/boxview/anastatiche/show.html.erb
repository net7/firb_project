<% imt_id = "imt_anastatica_#{@resource.id}" %>
<%= boxview_widget Anastatica, {:class => 'widget_draggable'} do |w|
  content = imt_viewer(imt_id) do |imt|
    imt.base64 = imt_image_b64 @image, @resource.showable_zones
    imt.init   = "jsapi_initializeIMW(id);"
    imt.click  = "$('#ana_zone_'+ki).click();"
    imt.over   = "$('#ana_zone_'+ki).addClass('zone_highlighted');"
    imt.out    = "$('#ana_zone_'+ki).removeClass('zone_highlighted');"
  end

  w.content content_tag(:div, content, :class => 'picture')
end %>


<%=
    boxview_widget 'Elementi correlati', {:class => 'widget_draggable'} do |w|
        @resource.showable_zones.shift
        @resource.showable_zones.each do |z|
            o = z.get_related_objects.first
            w.content "<ul>"
            w.content "<li>#{boxview_link_for_object(o, {:link_id => "ana_zone_#{z.id}"})}</li>";
            w.content << %[
                <script>
                    $('#ana_zone_#{z.id}').
                        mouseover(function(){ 
                            if (typeof(getFlashObject('#{imt_id}').setPolygonHighlighted) === 'function') {
                                getFlashObject('#{imt_id}').setPolygonHighlighted(true, '#{z.id}');
                                $(this).addClass('zone_highlighted');
                            }
                        }).mouseout(function(){ 
                            if (typeof(getFlashObject('imt_image_#{z.id}').setPolygonHighlighted) === 'function') {
                                getFlashObject('#{imt_id}').setPolygonHighlighted(false, '#{z.id}'); 
                                $(this).removeClass('zone_highlighted');
                            }
                        });
                </script>
            ]
            w.content "</ul>"
        end
    end
%>