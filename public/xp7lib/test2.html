<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" xmlns:dc="http://purl.org/dc/elements/1.1/" > 
  <head> 
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" /> 
	<title>Jaxer XPointers test application</title>

        <script type="text/javascript" runat='both' src='jquery.js' autoload='true'></script>
        <script type="text/javascript" runat='both' src='xp7Lib.js'></script>

        <style>
            #cl0, #cl1, #cl2, #cl3, #cl4, #cl5, #cl6, #cl7, #cl8, #cl9, #cl10,
            #cl11, #cl12, #cl13, #cl14, #cl15, #cl16 { border: 1px solid red; margin: 2px; padding: 2px; cursor: pointer;}
        </style>

	</head>
    <body>
        		<h2>This element has 8 annotations</h2> 

		<div about="http://swicky.muruca.org/Castruccio_Castracani#data217" class="THCContent" id="h_c3e02f4f2ad75c9685261d41fe46670d"><?xml version="1.0" encoding="UTF-8"?>
<!-- 
    Document   : Castruccio_Castracani
    Created on : 23-gen-2008, 22.18.54
    Author     : daniel
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <title>Castruccio Castracani</title>
    </head>
    <body>
        <img src="Castruccio_Castracani-litograph.jpg" alt="Litograph"/>

        <p>
            Castruccio Castracani degli Antelminelli (1281–September 3, 1328) was an Italian condottiero and duke of Lucca.
        </p>
        <h2>Biography</h2>
        <p>
            Castracani was born in Lucca, a member of the noble family of Antelminelli, of the Ghibelline party. In 1300 he was exiled with his parents and others of their faction by the Guelphs "Black" party, then in the ascendant. At nineteen he became orphaned, and subsequently served as a condottiero under Philip IV of France in Flanders, then with the Visconti in Lombardy, and in 1313 under the Ghibelline chief, Uguccione della Faggiuola, lord of Pisa, in central Italy.
        </p>
        <p>
            He assisted Uguccione in many enterprises, including the capture of Lucca (1314) and the Battle of Montecatini (1315), in which he was the main protagonist of the victory over the Guelph League led by the Florentines. However, due to his growing popularity, Uguccione had him jailed and condemned to death. An insurrection of the Lucchesi having led to the expulsion of Uguccione and his party, Castruccio regained his freedom and his position, and the Ghibelline triumph was presently assured.
        </p>
        <p>
            Elected lord (as lifelong consul) of Lucca on June 12, 1316, he warred incessantly against the Florentines, and was at first the faithful adviser and staunch supporter of Frederick of Austria, who made him imperial vicar of Lucca, Lunigiana and Val di Nievole in 1320. After the Battle of Mühldorf he went over to the emperor Louis the Bavarian, whom he served for many years. In 1325 he defeated the Florentines at Altopascio, and was appointed by the emperor duke of Lucca, Pistoia, Volterra and Luni; two years later he captured Pisa, of which he was made imperial vicar. But, subsequently, his relations with Louis seem to have grown less friendly and he was afterwards excommunicated by the papal legate in the interests of the Guelphs (1327).
        </p>
        <p>
            At his death in 1328 the fortunes of his young children were wrecked in the Guelph triumph.
        </p>
        <p>
            Niccolò Machiavelli's Life of Castruccio Castracani is his third important political book and signigficant for the understanding of Machiavelli's political philosophy.
        </p>
    </body>
</html>
</div>
   
   
<div>
    <span id="cl0">CL 0</span>
    <span id="cl1">CL 1</span>
    <span id="cl2">CL 2</span>
    <span id="cl3">CL 3</span>
    <span id="cl4">CL 4</span>
    <span id="cl5">CL 5</span>
    <span id="cl6">CL 6</span>
    <span id="cl7">CL 7</span>
    <span id="cl8">CL 8</span>
    <span id="cl9">CL 9</span>
    <span id="cl10">CL 10</span>
    <span id="cl11">CL 11</span>
    <span id="cl12">CL 12</span>
    <span id="cl13">CL 13</span>
    <span id="cl14">CL 14</span>
    <span id="cl15">CL 15</span>
    <span id="cl16">CL 16</span>
</div>
		<script type="text/javascript" runat="both">

        $(document).ready(function() {
            for (var i=0; i<=16; i++) {
                $("span#cl"+i).click(function() {
                    var cl = $(this).attr('id');

                    $("span").css({"background-color": "#fff"});
                    $("span."+cl).css({"background-color": "#fc0"});
                })
            }
        })

        // ServerLoad: fired when jaxer is done with loading the page
        window.onserverload = function() {
		    var xp = new $.xp7Lib({debug: true});
		    
		    var uris = [];

		    var uris = xp.getContentURIs();

                for (var i=0; i<uris.length; i++) {
                    xp.log(uris[i] + " <br>");
                
                    var baseURL = "http://swicky.muruca.org/swicky_notebooks/context/annotated_fragments",
                        // uri = escape(uris[i]), 
                        uri = escape('http://swicky.muruca.org/Castruccio_Castracani'),
                        url = baseURL + "?uri=" + uri;
                    var string = Jaxer.Web.get(url);

                    try { h = eval ("("+string+")"); } 
                    catch (e) { h = []; }

                    if (h.length == 0) return;

                    xp.log("# Got "+h.length+" new fragments from url "+url);
                    xp.log("## "+string);

                    xp.addXPathsFromXPointers(h);


                    var baseURL = "http://swicky.muruca.org/swicky_notebooks/context/annotated_fragments",
                        uri = escape(uris[i]), 
                        url = baseURL + "?uri=" + uri;
                    var string = Jaxer.Web.get(url);

                    try { h = eval ("("+string+")"); } 
                    catch (e) { h = []; }

                    if (h.length == 0) return;

                    xp.log("# Got "+h.length+" new fragments from url "+url);
                    xp.log("## "+string);

                    xp.addXPathsFromXPointers(h);

                    xp.splitAndSortXPaths();
                    xp.getClassesForRanges();
                    xp.updateDOM();

                    xp.stats();
                    // xp.highlightFromXPointers(h);

	            } // for
    	    
		} // onserverload()

		</script>

    </body>
</html>
