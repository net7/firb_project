


<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width; initial-scale=1.0">

  <title>
    API: BoxView
    
    
      &rarr; tools.js (file)
    
  </title>

  <link rel="stylesheet" type="text/css" href="css/960fluid.min.css">
  <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.4.custom.css">
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <link rel="stylesheet" type="text/css" href="css/navigation.css">
  <link rel="stylesheet" type="text/css" href="css/content.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Droid+Sans+Mono">
  
	<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->

</head>

<body>
  <div id="container" class="container_16">
    <a name="top"></a>

    <!-- HEADER -->
    <header>
      <div id="hd" class="grid_10">
        <h1>
          <a href="http://developer.yahoo.com/yui/" title="BoxView 1.0.3">BoxView 1.0.3</a> v
        </h1>
      </div> <!--! end of #hd -->
    </header>

    <div id="filters" class="grid_6">
      <form action="#" method="get" id="show-toggles">
        <fieldset>
          <legend>Display Filters</legend>
          <span class="classopts">
            <input type="checkbox" name="show_private" id="show_private">
            <label for="show_private">Show private</label>
          </span>
          <span class="classopts">
            <input type="checkbox" name="show_protected" id="show_protected">
            <label for="show_protected">Show protected</label>
          </span>
          <span class="classopts">
            <input type="checkbox" name="show_deprecated" id="show_deprecated">
            <label for="show_deprecated">Show deprecated</label>
          </span>
        </fieldset>
      </form>

    </div> <!--! end of #hd -->


    <!-- SUB-HEADER w/ BREADCRUMBS -->

    <div id="sub-hd" class="grid_16">
      <div id="breadcrumbs">
        <form id="search-form" method="get" action="#">
          <label for="search">Search:</label>
          <input type="text" id="search" title="Find documentation">
        </form>

        <a href="./index.html" title="BoxView 1.0.3">BoxView 1.0.3</a>
          &rarr; module <a href="./module_boxview.html" title="BoxView">BoxView</a>
          
          
            &rarr; file tools.js
          
      </div>
    </div> <!--! end of #sub-hd -->
    
    <div class="clear"></div>
    

    <!-- SIDEBAR NAVIGATION -->
    <nav>
      <div id="navigation" class="grid_4">
        <div>

            <div id="moduleList" class="module">
              <h4>Modules</h4>
              <ul>
                  <li  class="selected" >
                    <a href="module_boxview.html">BoxView</a>
                  </li>
              </ul>
            </div>

            <div id="classList" class="module">
              <h4>Classes</h4>
              <ul>
                  <li >
                    <a href="BoxViewSuiteConfig.html">BoxViewSuiteConfig</a>
                  </li>
              </ul>
            </div>

            <div id="fileList" class="module">
              <h4>Files</h4>
              <ul>
                  <li >
                    <a href="anchorman.js.html">anchorman.js</a>
                  </li>
                  <li >
                    <a href="boxtoolbar.js.html">boxtoolbar.js</a>
                  </li>
                  <li >
                    <a href="boxview.js.html">boxview.js</a>
                  </li>
                  <li >
                    <a href="boxview_config.js.html">boxview_config.js</a>
                  </li>
                  <li  class="selected" >
                    <a href="tools.js.html">tools.js</a>
                  </li>
                  <li >
                    <a href="urlshortener.js.html">urlshortener.js</a>
                  </li>
                  <li >
                    <a href="widgets.js.html">widgets.js</a>
                  </li>
              </ul>
            </div>





        </div>
      </div>  <!-- end of #navigation -->
    </nav>


    <div id="content" class="grid_12">
      


        <!--! source code view -->
        <div id="srcout">
          <h2>
            file <strong>tools.js</strong>
          </h2>

          <div class="highlight"><pre><span class="cm">/* Copyright (c) 2012 Net7 SRL, &lt;http://www.netseven.it/&gt;       */</span>
<span class="cm">/* This Software is released under the terms of the MIT License */</span>
<span class="cm">/* See LICENSE.TXT for the full text of the license.            */</span>

<span class="kd">function</span> <span class="nx">BoxStrapper</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Setting path to &quot;</span><span class="o">+</span><span class="nx">path</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">path</span> <span class="o">=</span> <span class="s1">&#39;../&#39;</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">userConfig</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">userConfig</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">userConfig</span><span class="p">;</span>

	<span class="k">this</span><span class="p">.</span><span class="nx">themePath</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">themePath</span> <span class="o">||</span> <span class="s1">&#39;themes/&#39;</span><span class="p">;</span>
	

    <span class="k">this</span><span class="p">.</span><span class="nx">startedAt</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">showOverlay</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">BoxStrapper</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>

    <span class="c1">// Items currently being loaded</span>
    <span class="nx">loadingItems</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> 
    <span class="c1">// Total number of items to load</span>
    <span class="nx">itemsToLoad</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> 
    <span class="c1">// Items already loaded</span>
    <span class="nx">loadedItems</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="c1">// Queue with items to load, indexed by prio</span>
    <span class="nx">loadingQueue</span><span class="o">:</span> <span class="p">[],</span>
    <span class="c1">// Lowest and highest prio</span>
    <span class="nx">lowestPrio</span><span class="o">:</span> <span class="mi">99999</span><span class="p">,</span> 
    <span class="nx">highestPrio</span><span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
    <span class="nx">levelsDone</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>

    <span class="c1">// Time in ms to signal a job as &#39;done&#39;. Used to call the remove</span>
    <span class="c1">// callback after a function or event which doesnt fire a proper</span>
    <span class="c1">// onLoad event</span>
    <span class="nx">forceRemoveTime</span><span class="o">:</span> <span class="mi">100</span><span class="p">,</span>

    <span class="c1">// Will be set to true when and if the startup screen gets initialized</span>
    <span class="nx">isStartupScreenActive</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">isQueueDone</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

    <span class="nx">debug</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>

    <span class="nx">init</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="c1">// The browser can load js and css together.. </span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCss</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;BoxView Stylesheet&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;css/boxview.css&#39;</span><span class="p">);</span>
		<span class="c1">// TODO are we using widgets? </span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCss</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;Widgets Stylesheet&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;css/widgets.css&#39;</span><span class="p">);</span>
		<span class="c1">// TODO are we using the toolbar?</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCss</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;BoxToolbar Stylesheet&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;css/boxtoolbar.css&#39;</span><span class="p">);</span>

        <span class="c1">// Load jquery if it&#39;s not already loaded</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> 
            <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;JQuery core&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;jq/jquery.js&#39;</span><span class="p">);</span>

        <span class="c1">// Load jquery-ui if it&#39;s not already loaded, after jquery to avoid UI to be</span>
        <span class="c1">// initialized before jQuery ..</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">jQuery</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;function&quot;</span> <span class="o">||</span> <span class="k">typeof</span><span class="p">(</span><span class="nx">$</span><span class="p">.</span><span class="nx">ui</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;object&quot;</span><span class="p">)</span> 
            <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;JQuery UI&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;jq/jquery-ui.js&#39;</span><span class="p">);</span>

        <span class="c1">// Load the configuration file</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> 
            <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;Suite config&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;src/boxview_config.js&#39;</span><span class="p">);</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCall</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="s2">&quot;User&#39;s custom config files&quot;</span><span class="p">,</span> 
                    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">userConfig</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">self</span><span class="p">.</span><span class="nx">loadScriptCheck</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="s2">&quot;User&#39;s configuration files config.js&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;config.js&#39;</span><span class="p">,</span> <span class="mi">37</span><span class="p">);</span>
                            <span class="c1">// self.loadScriptCheck(36, &quot;User&#39;s configuration files ../config.js&quot;, self.path + &#39;../config.js&#39;, 37);</span>
                        <span class="p">}</span> <span class="k">else</span> 
                            <span class="nx">self</span><span class="p">.</span><span class="nx">loadScriptCheck</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="s2">&quot;User&#39;s configuration via BoxStrapper()&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">userConfig</span><span class="p">,</span> <span class="mi">38</span><span class="p">);</span>
                    <span class="p">});</span>

        <span class="c1">// Load the css at run time, when we know which theme to use</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCall</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;Theme stylesheets&quot;</span><span class="p">,</span> 
                    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
						<span class="c1">// DEBUG TODO: what if we upgrade jquery UI? prolly best to force the name to jquery-ui.css</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCss</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="s2">&quot;Theme Jquery UI stylesheet&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">themePath</span> <span class="o">+</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">theme</span><span class="o">+</span><span class="s1">&#39;/jquery-ui/jquery-ui.css&#39;</span><span class="p">);</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="s2">&quot;Theme general config&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">themePath</span> <span class="o">+</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">theme</span><span class="o">+</span><span class="s1">&#39;/config.js&#39;</span><span class="p">);</span>
                        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCss</span><span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="s2">&quot;Theme general stylesheet&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">themePath</span> <span class="o">+</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">theme</span><span class="o">+</span><span class="s1">&#39;/css/style.css&#39;</span><span class="p">);</span>
                        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">userConfig</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> 
                            <span class="nx">self</span><span class="p">.</span><span class="nx">loadScriptCheck</span><span class="p">(</span><span class="mi">42</span><span class="p">,</span> <span class="s2">&quot;Overwriting theme config with user supplied config&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">userConfig</span><span class="p">,</span> <span class="mi">43</span><span class="p">);</span>
                    <span class="p">});</span>

        <span class="c1">// Show the startup screen if it&#39;s needed, AFTER the css.. </span>
        <span class="c1">// DEBUG: if the css is loaded after the startup screen.. it screws up .. :\</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCall</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;Showing startup screen&quot;</span><span class="p">,</span> 
                    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> 
                        <span class="k">if</span> <span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxStrapperConfig</span><span class="p">.</span><span class="nx">useStartupScreen</span><span class="p">)</span> 
                            <span class="nx">self</span><span class="p">.</span><span class="nx">addStartupScreenCode</span><span class="p">();</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#foo_remove_me&#39;</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">();</span>
                    <span class="p">});</span>

        <span class="c1">// Let&#39;s get all the code we need</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;URL Shortener core&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;src/urlshortener.js&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;BoxView core&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;src/boxview.js&#39;</span><span class="p">);</span>
		<span class="c1">// TODO: dont load all the js if we dont need them</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;AnchorMan core&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;src/anchorman.js&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;Base64 Lib&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;jq/base64.js&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;Widgets core&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;src/widgets.js&#39;</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;BoxToolbar and friends&quot;</span><span class="p">,</span> <span class="nx">self</span><span class="p">.</span><span class="nx">path</span> <span class="o">+</span> <span class="s1">&#39;src/boxtoolbar.js&#39;</span><span class="p">);</span>

        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCall</span><span class="p">(</span><span class="mi">70</span><span class="p">,</span> <span class="s2">&quot;Initializing Components&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">initComponents</span><span class="p">();</span> <span class="p">});</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadCall</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="s2">&quot;Initializing User&#39;s code&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">onInitDone</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="nx">onInitDone</span><span class="p">();</span> <span class="p">});</span>

        <span class="c1">// Let&#39;s start loading!</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">loadNextFromQueue</span><span class="p">();</span>
        
    <span class="p">},</span> <span class="c1">// init()</span>

    <span class="c1">// Will be called when everything is loaded and the queue is empty</span>
    <span class="nx">end</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Everything is loaded. BoxStrapper is done.&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addToStartupScreen</span><span class="p">(</span><span class="s2">&quot;Done!!&quot;</span><span class="p">);</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupProgress&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;&lt;span class=&#39;done&#39;&gt;BoxView is ready!&lt;/span&gt;&quot;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxStrapperConfig</span><span class="p">.</span><span class="nx">closeOnDone</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">sd</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupScreenDialog&#39;</span><span class="p">),</span>
                <span class="nx">wi</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.ui-widget-overlay&#39;</span><span class="p">),</span>
                <span class="nx">co</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxStrapperConfig</span><span class="p">;</span>
            <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>  
                    <span class="nx">wi</span><span class="p">.</span><span class="nx">fadeOut</span><span class="p">(</span><span class="nx">co</span><span class="p">.</span><span class="nx">animationLength</span><span class="p">);</span>
                    <span class="nx">sd</span><span class="p">.</span><span class="nx">slideUp</span><span class="p">(</span><span class="nx">co</span><span class="p">.</span><span class="nx">animationLength</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">sd</span><span class="p">.</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span> <span class="nx">wi</span><span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="p">});</span> 
                <span class="p">},</span> <span class="nx">co</span><span class="p">.</span><span class="nx">waitBeforeClose</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="c1">// end()</span>

    <span class="nx">addLoadingItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadingItems</span><span class="o">++</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="o">++</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingItems</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="o">+</span><span class="s2">&quot;: Loading &quot;</span><span class="o">+</span><span class="nx">name</span><span class="p">);</span>
    <span class="p">},</span>

    <span class="nx">removeLoadedItem</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span><span class="o">++</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span><span class="o">+</span><span class="s2">&quot;/&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="o">+</span><span class="s2">&quot;: DONE &quot;</span><span class="o">+</span><span class="nx">name</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">addToStartupScreen</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isQueueDone</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
    <span class="p">},</span>

    <span class="c1">// WIll load a css script adding this.path</span>
    <span class="nx">loadCss</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prio</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pushLoadingQueue</span><span class="p">({</span><span class="nx">file</span><span class="o">:</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;css&#39;</span><span class="p">,</span> <span class="nx">prio</span><span class="o">:</span> <span class="nx">prio</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="c1">// WIll load a script file adding this.path</span>
    <span class="nx">loadScript</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prio</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">file</span><span class="p">)</span> <span class="p">{</span> 
        <span class="k">this</span><span class="p">.</span><span class="nx">pushLoadingQueue</span><span class="p">({</span><span class="nx">file</span><span class="o">:</span> <span class="nx">file</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;js&#39;</span><span class="p">,</span> <span class="nx">prio</span><span class="o">:</span> <span class="nx">prio</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="nx">loadCall</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prio</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">fun</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pushLoadingQueue</span><span class="p">({</span><span class="nx">fun</span><span class="o">:</span> <span class="nx">fun</span><span class="p">,</span> <span class="nx">prio</span><span class="o">:</span> <span class="nx">prio</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">});</span>
    <span class="p">},</span>
    <span class="c1">// Will check if a script exists and load it, without adding any path</span>
    <span class="nx">loadScriptCheck</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">prio</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">checkFile</span><span class="p">,</span> <span class="nx">nextPrio</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">pushLoadingQueue</span><span class="p">({</span><span class="nx">checkfile</span><span class="o">:</span> <span class="nx">checkFile</span><span class="p">,</span> <span class="nx">prio</span><span class="o">:</span> <span class="nx">prio</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">nextprio</span><span class="o">:</span> <span class="nx">nextPrio</span><span class="p">});</span>
    <span class="p">},</span>

    <span class="nx">pushLoadingQueue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">highestPrio</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">highestPrio</span><span class="p">,</span> <span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">])</span> <span class="o">===</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>

        <span class="c1">// DEBUG: can add properties to this onbject such as &quot;reloading&quot; &quot;tryed N times&quot; &quot;whatever&quot;</span>
        <span class="nx">o</span><span class="p">.</span><span class="nx">valid</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">file</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Pushing new file into prio &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="o">+</span><span class="s2">&quot; list: &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">fun</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Pushing new function call into prio &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="o">+</span><span class="s2">&quot; list: &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">o</span><span class="p">.</span><span class="nx">checkfile</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Pushing new checkfile into prio &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="o">+</span><span class="s2">&quot; list: &quot;</span><span class="o">+</span><span class="nx">o</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">o</span><span class="p">.</span><span class="nx">prio</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">o</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span>

    <span class="c1">// Removes an item from the queue by name. Will search through all levels and</span>
    <span class="c1">// remove it. Once per level, the last item will trigger next level.</span>
    <span class="nx">removeFromLoadingQueue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>

		<span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Removing from queue: &#39;</span><span class="o">+</span><span class="nx">name</span><span class="p">);</span>

        <span class="c1">// debug: invert for</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">k</span><span class="o">&lt;=</span><span class="k">this</span><span class="p">.</span><span class="nx">highestPrio</span><span class="p">;</span> <span class="nx">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">// skip empty or non-existent levels, if we get over highestPrio.. we&#39;re already done.</span>
            <span class="c1">// DEBUG: who&#39;s calling this when we are alredy done?!</span>
            <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">k</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> 
                <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="o">++</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">highestPrio</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

            <span class="c1">// Find the item with that name and remove it</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">j</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">k</span><span class="p">][</span><span class="nx">j</span><span class="p">].</span><span class="nx">name</span> <span class="o">===</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">splice</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">removeLoadedItem</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>

                    <span class="c1">// The last item that gets removed triggers next priority level</span>
                    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="nx">k</span><span class="p">].</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;* Priority #&quot;</span><span class="o">+</span><span class="nx">k</span><span class="o">+</span><span class="s2">&quot; is done. Going for next&quot;</span><span class="p">);</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">levelsDone</span><span class="o">++</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
                        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">loadNextFromQueue</span><span class="p">();</span> <span class="p">},</span> <span class="nx">self</span><span class="p">.</span><span class="nx">forceRemoveTime</span><span class="p">);</span>
                    <span class="p">}</span>

                    <span class="c1">// As soon as we removed something, return</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">// if .name === name </span>
        <span class="p">}</span> <span class="c1">// for k</span>

    <span class="p">},</span> <span class="c1">// removeFromLoadingQueue()</span>

    <span class="c1">// This gets called every time an</span>
    <span class="nx">loadNextFromQueue</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        
        <span class="c1">// Skip undefined and empty levels and if there&#39;s nothing left, return or call end()</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">]</span> <span class="o">===</span> <span class="s2">&quot;undefined&quot;</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">].</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> 
            <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span> <span class="o">&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">highestPrio</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;** The queue is empty, loaded &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span><span class="o">+</span><span class="s2">&quot; items on &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">levelsDone</span><span class="o">+</span><span class="s2">&quot; priority levels.&quot;</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">isQueueDone</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                
                <span class="c1">// If the queue ended after loading all of the items, end!</span>
                <span class="c1">// If the queue is empty but there&#39;s still items to load, the </span>
                <span class="c1">// last removed item will trigger end()</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>

                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">])</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span> 
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Prio #&quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="o">+</span><span class="s2">&quot; is loading &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">].</span><span class="nx">length</span><span class="o">+</span><span class="s2">&quot; items:&quot;</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadingQueue</span><span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="p">][</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">addLoadingItem</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">fun</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;function&quot;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="c1">// Call the remove when the function is finished</span>
                    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
                    <span class="nx">item</span><span class="p">.</span><span class="nx">fun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="p">},</span> <span class="nx">self</span><span class="p">.</span><span class="nx">forceRemoveTime</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">checkfile</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">checkFile</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">checkfile</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">nextprio</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">file</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">_loadResource</span><span class="p">(</span><span class="nx">item</span><span class="p">.</span><span class="nx">file</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">item</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
                
            <span class="p">};</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Tried &quot;</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">lowestPrio</span><span class="o">+</span><span class="s2">&quot; but there was no object, going for next prio&quot;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">},</span> <span class="c1">// loadNextFromQueue()</span>

    <span class="c1">// Will check if the given file exist, looking from the current</span>
    <span class="c1">// page&#39;s path and adding a loadScript() call into the queue at </span>
    <span class="c1">// the given prio</span>
    <span class="nx">checkFile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">prio</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
            <span class="nx">l</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
            <span class="nx">h</span> <span class="o">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">pathname</span><span class="p">,</span>
            <span class="nx">p</span> <span class="o">=</span> <span class="p">(</span><span class="nx">l</span><span class="p">.</span><span class="nx">port</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nx">l</span><span class="p">.</span><span class="nx">port</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
            <span class="c1">// DEBUG: is this cross browser enough?? Changed twice for firefox.. :|</span>
            <span class="nx">absolutePath</span> <span class="o">=</span> <span class="nx">l</span><span class="p">.</span><span class="nx">protocol</span><span class="o">+</span><span class="s2">&quot;//&quot;</span><span class="o">+</span><span class="nx">l</span><span class="p">.</span><span class="nx">hostname</span><span class="o">+</span><span class="nx">p</span><span class="o">+</span><span class="nx">h</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">h</span><span class="p">.</span><span class="nx">lastIndexOf</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
            <span class="nx">absoluteFile</span> <span class="o">=</span> <span class="nx">absolutePath</span> <span class="o">+</span> <span class="nx">file</span><span class="p">,</span>
 			<span class="nx">absoluteFileIE</span> <span class="o">=</span> <span class="nx">absoluteFile</span> <span class="o">+</span> <span class="s1">&#39;?x=&#39;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">);</span>

        <span class="c1">// DEBUG: if the given file is already an absolute URL, just use it</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;HEAD&quot;</span><span class="p">,</span>
            <span class="nx">async</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="nx">url</span><span class="o">:</span> <span class="nx">absoluteFileIE</span><span class="p">,</span>
            <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
                <span class="nx">self</span><span class="p">.</span><span class="nx">loadScript</span><span class="p">(</span><span class="nx">prio</span><span class="p">,</span> <span class="s2">&quot;Checked file &quot;</span><span class="o">+</span><span class="nx">file</span><span class="p">,</span> <span class="nx">file</span><span class="p">);</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
            <span class="p">},</span>
            <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span> 
                <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;CheckFile FAILED on &quot;</span><span class="o">+</span><span class="nx">absoluteFile</span><span class="o">+</span><span class="s2">&quot;, not loading.&quot;</span><span class="p">);</span> 
                <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>    
    <span class="p">},</span> <span class="c1">// checkFile()</span>
    
    <span class="nx">_loadResource</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">field</span><span class="p">,</span> 
			<span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">,</span>
			<span class="nx">isIe</span> <span class="o">=</span> <span class="k">typeof</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ActiveXObject</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">;</span>

		<span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;_LOADRES &quot;</span><span class="o">+</span><span class="nx">file</span><span class="o">+</span><span class="s2">&quot; -- &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; -- &quot;</span><span class="o">+</span><span class="nx">type</span><span class="p">);</span>

        <span class="c1">// If it&#39;s an absolute URL, load it.. else add path and load it</span>
        <span class="c1">//if (file !== self.userConfig &amp;&amp; file.match(/http:/) === null) </span>
        <span class="c1">//    file = this.path + file;</span>

        <span class="c1">// DEBUG: random string to trick the cache</span>
        <span class="nx">file</span> <span class="o">+=</span> <span class="s1">&#39;?x=&#39;</span><span class="o">+</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="o">*</span><span class="mi">100000</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;css&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;link&#39;</span><span class="p">);</span>
            <span class="nx">s</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/css&#39;</span><span class="p">;</span>
            <span class="nx">s</span><span class="p">.</span><span class="nx">rel</span> <span class="o">=</span> <span class="s1">&#39;stylesheet&#39;</span><span class="p">;</span>
            <span class="nx">s</span><span class="p">.</span><span class="nx">media</span> <span class="o">=</span> <span class="s1">&#39;screen&#39;</span><span class="p">;</span>
            <span class="nx">field</span> <span class="o">=</span> <span class="s1">&#39;href&#39;</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;js&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">s</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
            <span class="nx">field</span> <span class="o">=</span> <span class="s1">&#39;src&#39;</span><span class="p">;</span>
            <span class="nx">s</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s1">&#39;text/javascript&#39;</span><span class="p">;</span>
        <span class="p">}</span>

		<span class="c1">// Always set the onload function for css files;</span>
		<span class="c1">// If it&#39;s IE, dont set it for other types</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isIe</span> <span class="o">||</span> <span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;css&#39;</span><span class="p">)</span>
	        <span class="nx">s</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
				<span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Normal browser correctly loaded &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span><span class="nx">file</span><span class="p">);</span> 
				<span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> 
			<span class="p">};</span>
        
        <span class="c1">// Lazy-load-a-css-little hack: poll every 100ms if the stylesheet has been loaded, </span>
		<span class="c1">// since some browsers dont fire the onload event for certain tags (LINK!).</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&quot;css&quot;</span><span class="p">)</span> <span class="p">{</span>
	        <span class="nx">s</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
	            <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;NORMAL BROWSER ERROR LOADING &quot;</span><span class="o">+</span> <span class="nx">name</span><span class="p">);</span> 
	            <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> 
	        <span class="p">}</span>
		    <span class="nx">s</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>  
			<span class="nx">s</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="nx">file</span><span class="p">;</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> 
	    
            <span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    			<span class="k">try</span> <span class="p">{</span>
    				<span class="nx">s</span><span class="p">.</span><span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">;</span>
    			<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    				<span class="nx">setTimeout</span><span class="p">(</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">callee</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
    				<span class="k">return</span><span class="p">;</span>
    			<span class="p">};</span>
                <span class="nx">s</span><span class="p">.</span><span class="nx">onload</span><span class="p">();</span> 
    		<span class="p">})();</span>
		<span class="p">}</span>

		<span class="c1">// IE doesnt fire onload callbacks for &lt;script&gt;. Using</span>
		<span class="c1">// an ajax call to get the content of the script, add</span>
		<span class="c1">// the &lt;script&gt; node to the dom putting content in its </span>
		<span class="c1">// .text field. </span>
		<span class="c1">// If it&#39;s a normal browser.. just append the node</span>
		<span class="c1">// and wait the onload() to get called</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;js&#39;</span><span class="p">)</span>
 			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isIe</span><span class="p">)</span> <span class="p">{</span>
		        <span class="nx">s</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> 
		            <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;NORMAL BROWSER ERROR LOADING &quot;</span><span class="o">+</span> <span class="nx">name</span><span class="p">);</span> 
		            <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> 
		        <span class="p">}</span>
		        <span class="nx">s</span><span class="p">.</span><span class="nx">async</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>  
				<span class="nx">s</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">=</span> <span class="nx">file</span><span class="p">;</span>
	            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span> 
			<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
	            <span class="kd">var</span> <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
	            <span class="k">try</span> <span class="p">{</span> <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
	                <span class="k">try</span> <span class="p">{</span> <span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">&quot;Msxml2.XMLHTTP&quot;</span><span class="p">);</span> <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span> 
						<span class="nx">xmlhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ActiveXObject</span><span class="p">(</span><span class="s2">&quot;Microsoft.XMLHTTP&quot;</span><span class="p">);</span> <span class="p">}}</span>  

				<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span>  <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
		            <span class="k">try</span> <span class="p">{</span>
		                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">done</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span>
		                    <span class="k">return</span><span class="p">;</span>

						<span class="c1">// Correctly loaded</span>
		                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="p">){</span>
		                    <span class="k">this</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
		                    <span class="nx">s</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
		                    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;head&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">s</span><span class="p">);</span>
							<span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;IE correctly loaded &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span><span class="nx">file</span><span class="p">);</span> 
		                    <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
		                <span class="p">}</span>
						<span class="c1">// Error somewhere</span>
		                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">){</span>
		                    <span class="k">this</span><span class="p">.</span><span class="nx">done</span> <span class="o">=</span>  <span class="kc">true</span><span class="p">;</span>
				            <span class="nx">self</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;ERROR LOADING WITH IE &quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot; :: &quot;</span><span class="o">+</span><span class="nx">file</span><span class="p">);</span> 
				            <span class="nx">self</span><span class="p">.</span><span class="nx">removeFromLoadingQueue</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> 
		                <span class="p">}</span>
		             <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">){}</span>
				  <span class="p">};</span>
	           	<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="nx">file</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>                             
				<span class="nx">xmlhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span> 

        	<span class="p">}</span> <span class="c1">// type === js &amp;&amp; isIe</span>

    <span class="p">},</span> <span class="c1">// _loadResource</span>
    
    <span class="nx">showOverlay</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// DEBUG: any better ideas than appending a div</span>
        <span class="nx">foo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">);</span>

		<span class="c1">// IE DEBUG: me dont like rgba() !</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">ActiveXObject</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span>
    	    <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span>
		<span class="k">else</span>
    	    <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">background</span> <span class="o">=</span> <span class="s2">&quot;rgba(0,0,0,0.85)&quot;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s1">&#39;100%&#39;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="s1">&#39;z-index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;10&quot;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="s1">&#39;absolute&#39;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">&quot;0px&quot;</span><span class="p">;</span>
        <span class="nx">foo</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="s1">&#39;foo_remove_me&#39;</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">foo</span><span class="p">);</span>
    <span class="p">},</span> <span class="c1">// showOverlay()</span>

    <span class="nx">addStartupScreenCode</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">// Remove the temporary black overlay and show the loading dialog</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s2">&quot;&lt;div id=&#39;startupScreenDialog&#39;&gt;&lt;div id=&#39;startupProgress&#39;&gt;&lt;span class=&#39;loaded&#39;&gt;0&lt;/span&gt;/&lt;span class=&#39;total&#39;&gt;0&lt;/span&gt;&lt;/div&gt;&quot;</span><span class="o">+</span>
                            <span class="s2">&quot;&lt;div id=&#39;startupProgressBar&#39;&gt;&lt;/div&gt;&lt;div id=&#39;startupScreenContainer&#39;&gt;&lt;/div&gt;&quot;</span><span class="p">);</span>

        <span class="c1">// Initialize the content of the startup screen dialog</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupScreenDialog&#39;</span><span class="p">).</span><span class="nx">dialog</span><span class="p">({</span>
            <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;BoxView is loading ...&#39;</span><span class="p">,</span>
        	<span class="nx">draggable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">resizable</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>	<span class="nx">bgiframe</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
    		<span class="nx">autoOpen</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">height</span><span class="o">:</span> <span class="mi">300</span><span class="p">,</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">420</span><span class="p">,</span>
    		<span class="nx">clearStyle</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">modal</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> 
    		<span class="nx">buttons</span><span class="o">:</span> <span class="p">{</span> <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">);</span> <span class="p">}</span> <span class="p">},</span>
    		<span class="nx">close</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span> 
    	<span class="p">});</span>

        <span class="c1">// Initialize the progress bar</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupProgressBar&#39;</span><span class="p">).</span><span class="nx">progressbar</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span> <span class="mi">10</span><span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">isStartupScreenActive</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">},</span> <span class="c1">// addStartupScreenCode()</span>
    
    <span class="nx">addToStartupScreen</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">// Dont update if there&#39;s no screen active!</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isStartupScreenActive</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupProgressBar&#39;</span><span class="p">).</span><span class="nx">progressbar</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span><span class="o">/</span><span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="o">*</span><span class="mi">100</span><span class="p">)});</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupProgress .loaded&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">loadedItems</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupProgress .total&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">itemsToLoad</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">5</span><span class="p">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupScreenContainer .fade&#39;</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;fade&#39;</span><span class="o">+</span><span class="nx">i</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;fade&#39;</span><span class="o">+</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#startupScreenContainer&#39;</span><span class="p">).</span><span class="nx">prepend</span><span class="p">(</span><span class="s2">&quot;&lt;div class=&#39;fade0&#39; style=&#39;clear:both;&#39;&gt;&lt;span class=&#39;ui-icon ui-icon-check&#39; style=&#39;float:left;&#39;&gt;&lt;/span&gt;&quot;</span><span class="o">+</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
    <span class="p">},</span> <span class="c1">// addToStartupScreen()</span>

    <span class="nx">initComponents</span><span class="o">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">bvn</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxViewName</span><span class="p">,</span>
            <span class="nx">amn</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">anchorManName</span><span class="p">,</span>
            <span class="nx">sen</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxViewSectionName</span><span class="p">,</span>
            <span class="nx">usn</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">urlShortenerName</span><span class="p">,</span>
            <span class="nx">win</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">widgetsName</span><span class="p">,</span>
			<span class="nx">tol</span> <span class="o">=</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxToolbarName</span><span class="p">,</span>
            <span class="nx">callBacks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;onSort&quot;</span><span class="p">,</span> <span class="s2">&quot;onAdd&quot;</span><span class="p">,</span> <span class="s2">&quot;onRemove&quot;</span><span class="p">,</span> <span class="s2">&quot;onCollapse&quot;</span><span class="p">,</span> <span class="s2">&quot;onExpand&quot;</span><span class="p">,</span> <span class="s2">&quot;onReplace&quot;</span><span class="p">];</span>

        <span class="c1">// Create the widgets helper object</span>
        <span class="nb">window</span><span class="p">[</span><span class="nx">win</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">widgets</span><span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">widgetsConfig</span><span class="p">);</span>

        <span class="c1">// Create the BoxView</span>
        <span class="nb">window</span><span class="p">[</span><span class="nx">bvn</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">boxView</span><span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxViewContainer</span><span class="p">,</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxViewConfig</span><span class="p">);</span>

        <span class="c1">// Set the BoxStrapper reference before the call_init_callback</span>
        <span class="nb">window</span><span class="p">[</span><span class="nx">bvn</span><span class="p">].</span><span class="nx">setBoxStrapper</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

        <span class="c1">// Create the URLShortener</span>
        <span class="nb">window</span><span class="p">[</span><span class="nx">usn</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">urlShortener</span><span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">URLShortenerConfig</span><span class="p">);</span>

		<span class="c1">// Create the BoxToolBox and friends</span>
		<span class="nb">window</span><span class="p">[</span><span class="nx">tol</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">BoxToolbar</span><span class="p">(</span><span class="nb">window</span><span class="p">[</span><span class="nx">bvn</span><span class="p">],</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">boxToolbarConfig</span><span class="p">);</span>

        <span class="c1">// Create the AnchorMan and connect some callbacks</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">useAnchorMan</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">window</span><span class="p">[</span><span class="nx">amn</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">$</span><span class="p">.</span><span class="nx">anchorMan</span><span class="p">(</span><span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">anchorManConfig</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="k">in</span> <span class="nx">callBacks</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">name</span> <span class="o">=</span> <span class="nx">callBacks</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="nb">window</span><span class="p">[</span><span class="nx">bvn</span><span class="p">][</span><span class="nx">name</span><span class="o">+</span><span class="s2">&quot;AddCallBack&quot;</span><span class="p">](</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nb">window</span><span class="p">[</span><span class="nx">amn</span><span class="p">].</span><span class="nx">set_section_from_object</span><span class="p">(</span><span class="nx">sen</span><span class="p">,</span> <span class="nb">window</span><span class="p">[</span><span class="nx">bvn</span><span class="p">].</span><span class="nx">getAnchorManDesc</span><span class="p">());</span> <span class="p">});</span>
            <span class="p">}</span>

        	<span class="nb">window</span><span class="p">[</span><span class="nx">amn</span><span class="p">].</span><span class="nx">setCallbacks</span><span class="p">(</span><span class="nx">sen</span><span class="p">,</span> <span class="nx">BoxViewSuiteConfig</span><span class="p">.</span><span class="nx">anchorManCallbacks</span><span class="p">);</span>
            <span class="nb">window</span><span class="p">[</span><span class="nx">amn</span><span class="p">].</span><span class="nx">describeSection</span><span class="p">(</span><span class="nx">sen</span><span class="p">,</span> <span class="nb">window</span><span class="p">[</span><span class="nx">bvn</span><span class="p">].</span><span class="nx">options</span><span class="p">.</span><span class="nx">anchorManDescription</span><span class="p">);</span>
        	<span class="nb">window</span><span class="p">[</span><span class="nx">amn</span><span class="p">].</span><span class="nx">call_init_callbacks</span><span class="p">();</span>
	    <span class="p">}</span>
    <span class="p">},</span> <span class="c1">// initComponents()</span>
 
	<span class="nx">log</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">w</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">debug</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span>
            <span class="k">return</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">console</span> <span class="o">==</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#debug_foo&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> 
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;body&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div id=&#39;debug_foo&#39; style=&#39;position: absolute; right:2px; bottom: 2px; border: 1px solid red; font-size: 1.1em;&#39;&gt;&lt;/div&gt;&quot;</span><span class="p">);</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#debug_foo&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;&lt;div&gt;&quot;</span><span class="o">+</span><span class="nx">w</span><span class="o">+</span><span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;#BoxStrapper# (&quot;</span><span class="o">+</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="k">this</span><span class="p">.</span><span class="nx">startedAt</span><span class="p">)</span><span class="o">/</span><span class="mi">1000</span><span class="o">+</span><span class="s2">&quot;) &quot;</span><span class="o">+</span><span class="nx">w</span><span class="p">);</span>
        <span class="p">}</span>
    
	<span class="p">}</span><span class="c1">// log</span>
    
<span class="p">};</span>
</pre></div>

        </div>

    </div>


    <div class="clear"></div>

    
    <footer>
      <div id="footer" class="grid_16">
        <p>
          Copyright &copy; 2012 Yahoo! Inc.. All rights reserved.
          &middot;
          Docs generated using <a href="http://developer.yahoo.com/yui/yuidoc/">YUIDoc</a> sporting the <a href="http://github.com/carlo/yuidoc-theme-dana">Dana theme</a>.
        </p>
      </div> <!--! end of #footer -->
    </footer>


    <div class="clear"></div>

  </div>

  <!-- Javascript at the bottom for fast page loading -->
  <script src="js/jquery-1.4.2.min.js" type="text/javascript"></script>
  <script src="js/jquery-ui-1.8.4.custom.min.js" type="text/javascript"></script>
  <script src="js/jquery.cookie.min.js" type="text/javascript"></script>
  <script src="js/main.js" type="text/javascript"></script>
  
</body>
</html>
